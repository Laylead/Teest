<!DOCTYPE html>
<html>
<head>
    <title>Your Video Call</title>
    <script src="https://cdn.agora.io/sdk/release/AgoraRTC_N-4.19.0.js"></script>
    <style>
        body { font-family: Arial; margin: 0; padding: 20px; background: #f5f5f5; }
        #videos { display: flex; flex-wrap: wrap; gap: 10px; }
        #local-video { width: 240px; height: 180px; background: #ddd; border-radius: 8px; }
        #remote-video { width: 640px; height: 480px; background: #eee; border-radius: 8px; }
        button { padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="videos">
        <div id="remote-video"></div>
        <div id="local-video"></div>
    </div>
    <button id="join-btn">Join Call</button>

    <script>
        // YOUR Agora configuration
        const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
        const params = new URLSearchParams(window.location.search);
        
        // Auto-join when page loads with token
        if (params.get('token')) {
            document.getElementById('join-btn').click();
        }

        document.getElementById('join-btn').addEventListener('click', async () => {
            try {
                // Join with YOUR App ID
                await client.join(
                    "974f4c7b124940a1a6ee5e526175118d",  // Your App ID
                    "main_room",  // Your channel name
                    params.get('token'),
                    params.get('uid') || null
                );
                
                // Publish local stream
                const [audioTrack, videoTrack] = await AgoraRTC.createMicrophoneAndCameraTracks();
                document.getElementById("local-video").appendChild(videoTrack.getPlayer());
                await client.publish([audioTrack, videoTrack]);
                
                // Subscribe to remote users
                client.on("user-published", async (user, mediaType) => {
                    await client.subscribe(user, mediaType);
                    if (mediaType === "video") {
                        document.getElementById("remote-video").appendChild(user.videoTrack.getPlayer());
                    }
                    if (mediaType === "audio") {
                        user.audioTrack.play();
                    }
                });
                
                document.getElementById('join-btn').textContent = "Connected!";
            } catch (e) {
                alert("Error: " + e.message);
            }
        });
    </script>
</body>
</html>
