<!DOCTYPE html>
<html>
<head>
    <title>Auto Call</title>
    <script src="https://cdn.agora.io/sdk/release/AgoraRTC_N-4.19.0.js"></script>
    <style>
        body { font-family: Arial; text-align: center; padding: 20px; }
        #video-container { width: 100%; max-width: 800px; margin: 0 auto; }
        #local-video { width: 240px; height: 180px; background: #eee; }
        #remote-video { width: 640px; height: 480px; background: #ddd; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="video-container">
        <div id="local-video"></div>
        <div id="remote-video"></div>
        <button id="call-btn">Join Call</button>
    </div>

    <script>
        // Auto-join when page loads
        const params = new URLSearchParams(window.location.search);
        const token = params.get('token');
        
        if (token) {
            document.getElementById('call-btn').click();
        }

        // Agora setup
        const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
        let localTracks = [];
        
        document.getElementById('call-btn').addEventListener('click', async () => {
            try {
                await client.join(
                    "974f4c7b124940a1a6ee5e526175118d",
                    "main_room",
                    token,
                    Date.now() % 100000
                );
                
                localTracks = await AgoraRTC.createMicrophoneAndCameraTracks();
                document.getElementById("local-video").appendChild(localTracks[1].getPlayer());
                await client.publish(localTracks);
                
                client.on("user-published", async (user, mediaType) => {
                    await client.subscribe(user, mediaType);
                    if (mediaType === "video") {
                        document.getElementById("remote-video").appendChild(user.videoTrack.getPlayer());
                    }
                    if (mediaType === "audio") {
                        user.audioTrack.play();
                    }
                });
                
                document.getElementById('call-btn').textContent = "Connected!";
            } catch (e) {
                alert("Error: " + e.message);
            }
        });
    </script>
</body>
</html>
